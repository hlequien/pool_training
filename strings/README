For every functions here, malloc is the only external function allowed.